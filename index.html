<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>C√çCERO | Orquestrador Estrat√©gico</title>
  <style>
    body {
      background-color: #0d1117;
      color: #c9d1d9;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    
    header {
      background-color: #161b22;
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
      color: #58a6ff;
      border-bottom: 1px solid #30363d;
    }
    
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 2rem;
      max-width: 800px;
      margin: 0 auto;
      width: 100%;
    }
    
    .input-container {
      width: 100%;
      max-width: 600px;
      margin-bottom: 1rem;
    }
    
    textarea {
      width: 100%;
      height: 120px;
      padding: 1rem;
      font-size: 1rem;
      border: 2px solid #30363d;
      border-radius: 8px;
      background-color: #21262d;
      color: #c9d1d9;
      resize: vertical;
      font-family: inherit;
      transition: border-color 0.3s ease;
    }
    
    textarea:focus {
      outline: none;
      border-color: #58a6ff;
    }
    
    textarea::placeholder {
      color: #7d8590;
    }
    
    .button-container {
      display: flex;
      gap: 1rem;
      align-items: center;
      margin-bottom: 2rem;
    }
    
    button {
      padding: 0.75rem 2rem;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      background-color: #238636;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
      font-weight: 500;
    }
    
    button:hover {
      background-color: #2ea043;
    }
    
    button:disabled {
      background-color: #484f58;
      cursor: not-allowed;
    }
    
    .clear-btn {
      background-color: #6f42c1;
    }
    
    .clear-btn:hover {
      background-color: #8957e5;
    }
    
    .status {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9rem;
      color: #7d8590;
    }
    
    .status.thinking {
      color: #58a6ff;
    }
    
    .status.error {
      color: #f85149;
    }
    
    .status.success {
      color: #3fb950;
    }
    
    .loading-dots {
      display: inline-block;
    }
    
    .loading-dots::after {
      content: '';
      animation: dots 1.5s infinite;
    }
    
    @keyframes dots {
      0%, 20% { content: ''; }
      40% { content: '.'; }
      60% { content: '..'; }
      80%, 100% { content: '...'; }
    }
    
    .response {
      margin-top: 2rem;
      max-width: 600px;
      background-color: #161b22;
      padding: 1.5rem;
      border-radius: 8px;
      color: #adbac7;
      white-space: pre-wrap;
      border: 1px solid #30363d;
      line-height: 1.6;
      min-height: 100px;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .response:empty {
      display: none;
    }
    
    .webhook-info {
      background-color: #0d1117;
      border: 1px solid #f85149;
      border-radius: 6px;
      padding: 1rem;
      margin-bottom: 2rem;
      color: #f85149;
      font-size: 0.9rem;
      text-align: center;
    }
    
    .webhook-url {
      background-color: #21262d;
      padding: 0.5rem;
      border-radius: 4px;
      font-family: monospace;
      margin: 0.5rem 0;
      word-break: break-all;
    }
    
    @media (max-width: 768px) {
      main {
        padding: 1rem;
      }
      
      .button-container {
        flex-direction: column;
        width: 100%;
      }
      
      button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <header>üß† C√çCERO ‚Äî Conselheiro Estrat√©gico</header>
  <main>
    <div class="webhook-info">
      ‚ö†Ô∏è <strong>URL atual do webhook:</strong>
      <div class="webhook-url">https://hook.us2.make.com/o606fshpzvbq4326n7w67lg77ctwfmb3</div>
      Se houver erro, verifique se essa URL est√° correta no Make.com
    </div>
    
    <div class="input-container">
      <textarea 
        id="userInput" 
        placeholder="Digite sua pergunta para o C√çCERO...&#10;&#10;Exemplos:&#10;‚Ä¢ C√≠cero, convoque o board para analisar expans√£o para Miami&#10;‚Ä¢ C√≠cero, preciso de ajuda com decis√£o de investimento&#10;‚Ä¢ C√≠cero, an√°lise Brasil vs EUA para este projeto"
      ></textarea>
    </div>
    
    <div class="button-container">
      <button onclick="sendMessage()" id="sendBtn">Enviar Mensagem</button>
      <button onclick="clearResponse()" class="clear-btn">Limpar</button>
      <div class="status" id="status"></div>
    </div>
    
    <div class="response" id="response"></div>
  </main>

  <script>
    let isProcessing = false;

    // Focar no textarea ao carregar a p√°gina
    window.onload = function() {
      document.getElementById('userInput').focus();
    };

    // Permitir envio com Ctrl+Enter
    document.getElementById('userInput').addEventListener('keydown', function(e) {
      if (e.ctrlKey && e.key === 'Enter') {
        sendMessage();
      }
    });

    function updateStatus(message, type = '') {
      const statusEl = document.getElementById('status');
      statusEl.textContent = message;
      statusEl.className = `status ${type}`;
    }

    function clearResponse() {
      document.getElementById('response').textContent = '';
      document.getElementById('userInput').value = '';
      updateStatus('');
      document.getElementById('userInput').focus();
    }

    async function sendMessage() {
      if (isProcessing) return;

      const input = document.getElementById('userInput').value.trim();
      const responseDiv = document.getElementById('response');
      const sendBtn = document.getElementById('sendBtn');
      
      if (!input) {
        updateStatus("Por favor, digite uma pergunta.", "error");
        return;
      }

      // Atualizar UI para estado de processamento
      isProcessing = true;
      sendBtn.disabled = true;
      sendBtn.textContent = 'Enviando...';
      updateStatus('C√çCERO est√° pensando', 'thinking');
      responseDiv.innerHTML = '<span class="loading-dots">Processando sua solicita√ß√£o</span>';
      responseDiv.style.display = 'block';

      try {
        console.log('Enviando mensagem:', input);
        
        const response = await fetch('https://hook.us2.make.com/o606fshpzvbq4326n7w67lg77ctwfmb3', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify({ 
            message: input,
            timestamp: new Date().toISOString(),
            source: 'cicero-chat'
          })
        });

        console.log('Status da resposta:', response.status);
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const data = await response.json();
        console.log('Dados recebidos:', data);
        
        if (data.reply || data.response || data.message) {
          const reply = data.reply || data.response || data.message;
          responseDiv.textContent = reply;
          updateStatus('Resposta recebida com sucesso!', 'success');
        } else {
          throw new Error('Resposta vazia do servidor');
        }

      } catch (error) {
        console.error('Erro detalhado:', error);
        
        let errorMessage = "Erro ao conectar com C√çCERO. ";
        
        if (error.name === 'TypeError' && error.message.includes('fetch')) {
          errorMessage += "Problema de rede ou CORS. Verifique se o Make.com est√° ativo.";
        } else if (error.message.includes('HTTP')) {
          errorMessage += `Erro do servidor: ${error.message}`;
        } else {
          errorMessage += `${error.message}. Tente novamente em alguns segundos.`;
        }
        
        responseDiv.textContent = errorMessage;
        updateStatus("Erro na comunica√ß√£o", "error");
      } finally {
        // Restaurar UI
        isProcessing = false;
        sendBtn.disabled = false;
        sendBtn.textContent = 'Enviar Mensagem';
        
        setTimeout(() => {
          if (document.getElementById('status').classList.contains('success')) {
            updateStatus('');
          }
        }, 3000);
      }
    }

    // Debug info no console
    console.log('C√çCERO Chat carregado. URL do webhook:', 'https://hook.us2.make.com/o606fshpzvbq4326n7w67lg77ctwfmb3');
  </script>
</body>
</html>
